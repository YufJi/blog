<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序中JSBridge的实现 | YufJ&#39;s Daily</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/icons/icon.png">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="apple-touch-icon" href="/blog/icons/icon.png">
    <meta name="description" content="记录自己的刷题之旅和分享">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#F3F3F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="msapplication-TileImage" content="/icons/icon.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/blog/assets/css/0.styles.e05e9135.css" as="style"><link rel="preload" href="/blog/assets/js/app.e5e0fbf3.js" as="script"><link rel="preload" href="/blog/assets/js/2.ff78d0ce.js" as="script"><link rel="preload" href="/blog/assets/js/4.6f552e87.js" as="script"><link rel="preload" href="/blog/assets/js/5.2d578415.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.79b1ca23.js"><link rel="prefetch" href="/blog/assets/js/11.4f9a7eb6.js"><link rel="prefetch" href="/blog/assets/js/12.5fcae337.js"><link rel="prefetch" href="/blog/assets/js/13.686cad59.js"><link rel="prefetch" href="/blog/assets/js/14.de559b4a.js"><link rel="prefetch" href="/blog/assets/js/15.0cfe5450.js"><link rel="prefetch" href="/blog/assets/js/16.35218e0c.js"><link rel="prefetch" href="/blog/assets/js/17.2409b2c8.js"><link rel="prefetch" href="/blog/assets/js/18.e3f76bbf.js"><link rel="prefetch" href="/blog/assets/js/19.4698954f.js"><link rel="prefetch" href="/blog/assets/js/20.3650291b.js"><link rel="prefetch" href="/blog/assets/js/21.196aa8a2.js"><link rel="prefetch" href="/blog/assets/js/22.d281647c.js"><link rel="prefetch" href="/blog/assets/js/23.1fb02562.js"><link rel="prefetch" href="/blog/assets/js/24.ce21ff6c.js"><link rel="prefetch" href="/blog/assets/js/25.4d6e6a14.js"><link rel="prefetch" href="/blog/assets/js/26.cede6143.js"><link rel="prefetch" href="/blog/assets/js/27.a7ee0d37.js"><link rel="prefetch" href="/blog/assets/js/28.71aa5981.js"><link rel="prefetch" href="/blog/assets/js/29.05fb8d17.js"><link rel="prefetch" href="/blog/assets/js/3.42199638.js"><link rel="prefetch" href="/blog/assets/js/30.4f10f563.js"><link rel="prefetch" href="/blog/assets/js/31.8ae83be5.js"><link rel="prefetch" href="/blog/assets/js/32.03e52466.js"><link rel="prefetch" href="/blog/assets/js/33.0dbb77b5.js"><link rel="prefetch" href="/blog/assets/js/34.f57c6e66.js"><link rel="prefetch" href="/blog/assets/js/35.8fdec0b1.js"><link rel="prefetch" href="/blog/assets/js/36.e13ddc4f.js"><link rel="prefetch" href="/blog/assets/js/37.f2205b6c.js"><link rel="prefetch" href="/blog/assets/js/38.27b5f2a4.js"><link rel="prefetch" href="/blog/assets/js/39.16a2e5e6.js"><link rel="prefetch" href="/blog/assets/js/40.f3a6d96e.js"><link rel="prefetch" href="/blog/assets/js/41.2066f8a9.js"><link rel="prefetch" href="/blog/assets/js/42.0cf8ddb2.js"><link rel="prefetch" href="/blog/assets/js/43.64663163.js"><link rel="prefetch" href="/blog/assets/js/44.73d4d4ca.js"><link rel="prefetch" href="/blog/assets/js/45.419d6336.js"><link rel="prefetch" href="/blog/assets/js/46.62605f6f.js"><link rel="prefetch" href="/blog/assets/js/47.6519216c.js"><link rel="prefetch" href="/blog/assets/js/48.17351e90.js"><link rel="prefetch" href="/blog/assets/js/49.d446fea5.js"><link rel="prefetch" href="/blog/assets/js/50.2eb73eac.js"><link rel="prefetch" href="/blog/assets/js/51.269419de.js"><link rel="prefetch" href="/blog/assets/js/52.9cbb7f96.js"><link rel="prefetch" href="/blog/assets/js/53.ab682d5e.js"><link rel="prefetch" href="/blog/assets/js/54.7ba71bed.js"><link rel="prefetch" href="/blog/assets/js/55.19ea6786.js"><link rel="prefetch" href="/blog/assets/js/6.854148ae.js"><link rel="prefetch" href="/blog/assets/js/7.fa17fc74.js"><link rel="prefetch" href="/blog/assets/js/8.b08f96d5.js"><link rel="prefetch" href="/blog/assets/js/9.0cc67391.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.e05e9135.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">YufJ's Daily</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>小程序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/Tiny/事件系统.html" class="sidebar-link">小程序事件系统</a></li><li><a href="/blog/Tiny/关于小程序的探索.html" class="sidebar-link">关于小程序的探索</a></li><li><a href="/blog/Tiny/小程序JSBridge.html" class="active sidebar-link">小程序中JSBridge的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/Tiny/小程序JSBridge.html#jsbridge的介绍" class="sidebar-link">JSBridge的介绍</a></li><li class="sidebar-sub-header"><a href="/blog/Tiny/小程序JSBridge.html#根据小程序特点实现jsbridge" class="sidebar-link">根据小程序特点实现JSBridge</a></li><li class="sidebar-sub-header"><a href="/blog/Tiny/小程序JSBridge.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/blog/Tiny/小程序JSBridge.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog/Tiny/自定义组件web-component化.html" class="sidebar-link">自定义组件web-component化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="小程序中jsbridge的实现"><a href="#小程序中jsbridge的实现" class="header-anchor">#</a> 小程序中JSBridge的实现</h1> <h2 id="jsbridge的介绍"><a href="#jsbridge的介绍" class="header-anchor">#</a> JSBridge的介绍</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> jsCore<span class="token punctuation">;</span>
<span class="token comment">/* Android端注入 */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>JSCore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  jsCore <span class="token operator">=</span> JSCore<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* iOS端 */</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> messageHandlers <span class="token operator">=</span> self<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">;</span>
  jsCore <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">call</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> paramsString<span class="token punctuation">,</span> webviewIdsString<span class="token punctuation">,</span> callbackId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      messageHandlers<span class="token punctuation">.</span>BridgeCall<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> paramsString<span class="token punctuation">,</span> webviewIdsString<span class="token punctuation">,</span> callbackId<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">publish</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> paramsString<span class="token punctuation">,</span> webviewIdsString</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      messageHandlers<span class="token punctuation">.</span>BridgePublish<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> paramsString<span class="token punctuation">,</span> webviewIdsString<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="根据小程序特点实现jsbridge"><a href="#根据小程序特点实现jsbridge" class="header-anchor">#</a> 根据小程序特点实现JSBridge</h2> <p>从底层来看小程序和h5唯一的区别，是将视图和逻辑隔离形成了双线程，jsb需要承载线程之间的通信功能，其实就是纯粹的转发能力。</p> <p>jsb主要可以分为：</p> <p>调用类：</p> <ul><li>调用native能力[1]</li> <li>调用线程[2] （逻辑层-&gt;渲染层、渲染层-&gt;逻辑层)</li></ul> <img src="/blog/assets/img/invoke.002d3d5d.png" height="200"> <img src="/blog/assets/img/publish.0518948d.png" height="200"> <p>监听类：</p> <ul><li>监听native事件[3]</li> <li>监听线程[4]</li></ul> <img src="/blog/assets/img/onNative.93d5cda8.png" width="300"> <p>回调类：由native执行调用，一般不暴露给使用者</p> <ul><li>调用native能力[1]后的回调</li> <li>监听事件的回调[5]，消息包含监听native事件[3]的回调、监听线程[4]的回调</li></ul> <p>所以简单实现如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createInvoke</span><span class="token punctuation">(</span><span class="token parameter">jsCore</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> resolveId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 调用唯一标识</span>
  <span class="token keyword">const</span> resolveMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 调用native能力[1] */</span>
  <span class="token keyword">function</span> <span class="token function">invokeNative</span><span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> params<span class="token punctuation">,</span> webviewId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> response<span class="token punctuation">;</span>

    <span class="token keyword">const</span> deferred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      resolveId<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
      resolveMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>resolveId<span class="token punctuation">,</span> resolve<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂不考虑失败情况</span>

      <span class="token keyword">const</span> paramsString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> webviewIds <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>webviewId<span class="token punctuation">)</span> <span class="token operator">?</span> webviewId <span class="token operator">:</span> <span class="token punctuation">[</span>webviewId<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> webviewIdsString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>webviewIds<span class="token punctuation">)</span><span class="token punctuation">;</span>

      response <span class="token operator">=</span> <span class="token function">jsCore</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> paramsString<span class="token punctuation">,</span> webviewIdsString<span class="token punctuation">,</span> resolveId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">/* 同步api */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      resolveMap<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>resolveId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* 异步api */</span>
    <span class="token keyword">return</span> deferred<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* 调用native能力[1]后的回调 */</span>
  <span class="token keyword">function</span> <span class="token function">invokeHandler</span><span class="token punctuation">(</span><span class="token parameter">resolveId<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> resolve <span class="token operator">=</span> resolveMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>resolveId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resolve<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    invokeNative<span class="token punctuation">,</span>
    invokeHandler
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createPublish</span><span class="token punctuation">(</span><span class="token parameter">jsCore</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 调用线程[2] */</span>
  <span class="token keyword">const</span> <span class="token function-variable function">publish</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> params<span class="token punctuation">,</span> webviewId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> paramsString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> webviewIds <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>webviewId<span class="token punctuation">)</span> <span class="token operator">?</span> webviewId <span class="token operator">:</span> <span class="token punctuation">[</span>webviewId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> webviewIdsString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>webviewIds<span class="token punctuation">)</span><span class="token punctuation">;</span>

    jsCore<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CUSTOM_EVENT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> paramsString<span class="token punctuation">,</span> webviewIdsString<span class="token punctuation">,</span> g<span class="token punctuation">.</span>__IS_WORKER__<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    publish<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createSubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> nativeEmitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> customEmitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 监听native事件[3] */</span>
    onNative<span class="token operator">:</span> nativeEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>nativeEmitter<span class="token punctuation">)</span><span class="token punctuation">,</span>
    offNative<span class="token operator">:</span> nativeEmitter<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>nativeEmitter<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/* 监听线程[4] */</span>
    <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      customEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>customEmitter<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">custom_event_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      customEmitter<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>customEmitter<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">custom_event_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/* 监听事件的回调[5] */</span>
    <span class="token function">subscribeHandler</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> data<span class="token punctuation">,</span> webviewId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'custom_event_'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        customEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>customEmitter<span class="token punctuation">,</span> event<span class="token punctuation">,</span> params<span class="token punctuation">,</span> webviewId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        nativeEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>nativeEmitter<span class="token punctuation">,</span> event<span class="token punctuation">,</span> params<span class="token punctuation">,</span> webviewId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>所以上面实现后的jsb，对使用者暴露的方法为：</p> <ul><li>invokeNative</li> <li>onNative</li> <li>offNative</li> <li>publish</li> <li>subscribe</li> <li>unsubscribe</li></ul> <p>invokeHandler和subscribeHandler挂载到全局，供native调用使用。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://github.com/quickhybrid/quickhybrid/issues/10" target="_blank" rel="noopener noreferrer">H5和Native交互原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/quickhybrid/quickhybrid/issues/9" target="_blank" rel="noopener noreferrer">JSBridge的实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhaomenghuan.js.org/blog/what-is-emp.html#%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6" target="_blank" rel="noopener noreferrer">EMP通信机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/Tiny/关于小程序的探索.html" class="prev">
        关于小程序的探索
      </a></span> <span class="next"><a href="/blog/Tiny/自定义组件web-component化.html">
        自定义组件web-component化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.e5e0fbf3.js" defer></script><script src="/blog/assets/js/2.ff78d0ce.js" defer></script><script src="/blog/assets/js/4.6f552e87.js" defer></script><script src="/blog/assets/js/5.2d578415.js" defer></script>
  </body>
</html>
